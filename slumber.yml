# Note: This file is meant primarily for development and testing of Slumber. It
# is not intended as documentation. While it may be a helpful example, canonical
# documentation is at: https://slumber.lucaspickering.me/book/

.base_profile_data: &base_profile_data
  username: xX{{ command(['whoami']) | trim() | sensitive() }}Xx
  user_guid: abc123
.base_request: &base_request
  headers:
    Accept: application/json

profiles:
  works:
    name: This Works
    data:
      <<: *base_profile_data
      host: https://httpbin.org
  local:
    name: Local
    default: true
    data:
      <<: *base_profile_data
      host: http://localhost:80
  init-fails:
    name: Request Init Fails
    data:
      <<: *base_profile_data
  request-fails:
    name: Request Fails
    data:
      <<: *base_profile_data
      host: http://localhost:5000

requests:
  authentication: !folder
    requests:
      login: !request
        <<: *base_request
        method: POST
        url: "{{ host }}/anything/login"
        persist: false
        query:
          sudo: yes_please
          fast: [no_thanks, actually_maybe]
        body: !form_urlencoded
          username: "{{ username }}"
          password: "{{ prompt(message='Password', sensitive=true) }}"

      basic_auth: !request
        <<: *base_request
        method: POST
        url: "{{ host }}/anything/login"
        persist: false
        authentication: !basic
          username: "{{ username }}"
          password: "{{ prompt(message='Password') }}"
        query:
          sudo: yes_please
          fast: [no_thanks, actually_maybe]
        headers:
          Accept: application/json

      bearer_auth: !request
        <<: *base_request
        method: POST
        url: "{{ host }}/anything/login"
        persist: false
        authentication: !bearer "{{ response('login', trigger='12h') | jsonpath('$.form') }}"
        query:
          sudo: yes_please
          fast: [no_thanks, actually_maybe]
        headers:
          Accept: application/json

  users: !folder
    name: Users
    requests:
      get_users: !request
        <<: *base_request
        name: Get Users
        method: GET
        url: "{{ host }}/get"

      get_user: !request
        <<: *base_request
        name: Get User
        method: GET
        url: "{{ host }}/anything/{{ user_guid }}"
        query:
          foo: bar
          select_static: "{{ select(
            ['foo', 'bar', 'baz', 'a really really really really long option', username],
            message='Select a value'
            ) }}"
          select_dynamic: "{{ response('get_users') | jsonpath('$.headers') | select() }}"

      modify_user: !request
        <<: *base_request
        name: Modify User
        method: PUT
        url: "{{ host }}/anything/{{ user_guid }}"
        body:
          !json {
            "new_username": "user formerly known as {{ username }}",
            "number": 3,
            "bool": true,
            "null": null,
            "array": [1, 2, false, 3.3, "www.www"],
          }

  get_image: !request
    headers:
      Accept: image/png
    name: Get Image
    method: GET
    url: "{{ host }}/image"

  upload_image: !request
    <<: *base_request
    name: Upload Image
    method: POST
    url: "{{ host }}/anything/image"
    body: !form_multipart
      filename: "logo.png"
      image: "{{ file('static/slumber.png') }}"

  big_file: !request
    <<: *base_request
    name: Big File
    method: POST
    url: "{{ host }}/anything"
    body: "{{ file('Cargo.lock') }}"

  raw_json: !request
    <<: *base_request
    name: Raw JSON
    method: POST
    url: "{{ host }}/anything"
    headers:
      Content-Type: application/json
    body: >
      {
        "location": "boston",
        "size": "HUGE"
      }

  delay: !request
    <<: *base_request
    name: Delay
    method: GET
    url: "{{ host }}/delay/5"

  dynamic_response_type: !request
    <<: *base_request
    name: Dynamic Response Type
    method: GET
    url: "{{ host }}/{{ select(['json', 'html', 'xml']) }}"

  redirect: !request
    name: Redirect
    method: GET
    url: "{{host}}/redirect-to?url={{host}}/get"

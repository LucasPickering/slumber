# yaml-language-server: $schema=./schemas/collection.json
# Note: This file is meant primarily for development and testing of Slumber. It
# is not intended as documentation. While it may be a helpful example, canonical
# documentation is at: https://slumber.lucaspickering.me/book/

.base_profile_data: &base_profile_data
  username: xX{{ command(['whoami']) | trim() | sensitive() }}Xx
  user_guid: abc123
.base_request: &base_request
  type: request
  headers:
    Accept: application/json

profiles:
  works:
    name: This Works
    data:
      <<: *base_profile_data
      host: https://httpbin.org
  local:
    name: Local
    default: true
    data:
      <<: *base_profile_data
      host: http://localhost:80
  init-fails:
    name: Request Init Fails
    data:
      <<: *base_profile_data
  request-fails:
    name: Request Fails
    data:
      <<: *base_profile_data
      host: http://localhost:5000

requests:
  authentication:
    type: folder
    requests:
      login:
        <<: *base_request
        method: POST
        url: "{{ host }}/anything/login"
        persist: false
        query:
          sudo: yes_please
          fast: [no_thanks, actually_maybe]
        body:
          type: form_urlencoded
          data:
            username: "{{ username }}"
            password: "{{ prompt(message='Password', sensitive=true) }}"

      basic_auth:
        <<: *base_request
        method: POST
        url: "{{ host }}/anything/login"
        persist: false
        authentication:
          type: basic
          username: "{{ username }}"
          password: "{{ prompt(message='Password') }}"
        query:
          sudo: yes_please
          fast: [no_thanks, actually_maybe]
        headers:
          Accept: application/json

      bearer_auth:
        <<: *base_request
        method: POST
        url: "{{ host }}/anything/login"
        persist: false
        authentication:
          type: bearer
          token: "{{ response('login', trigger='12h') | jsonpath('$.form') }}"
        query:
          sudo: yes_please
          fast: [no_thanks, actually_maybe]
        headers:
          Accept: application/json

  users:
    type: folder
    name: Users
    requests:
      get_users:
        <<: *base_request
        name: Get Users
        method: GET
        url: "{{ host }}/get"

      get_user:
        <<: *base_request
        name: Get User
        method: GET
        url: "{{ host }}/anything/{{ user_guid }}"
        query:
          foo: bar
          select_static: "{{ select(
            ['foo', 'bar', 'baz', 'a really really really really long option', username],
            message='Select a value'
            ) }}"
          select_dynamic: "{{ response('get_users') | jsonpath('$.headers', mode='array') | select() }}"

      modify_user:
        <<: *base_request
        name: Modify User
        method: PUT
        url: "{{ host }}/anything/{{ user_guid }}"
        body:
          type: json
          data:
            {
              "new_username": "user formerly known as {{ username }}",
              "number": 3,
              "bool": true,
              "null": null,
              "array": [1, 2, false, 3.3, "www.www"],
            }

  get_image:
    type: request
    headers:
      Accept: image/png
    name: Get Image
    method: GET
    url: "{{ host }}/image"

  upload_image:
    <<: *base_request
    name: Upload Image
    method: POST
    url: "{{ host }}/anything/image"
    body:
      type: form_multipart
      data:
        filename: "logo.png"
        image: "{{ file('static/slumber.png') }}"

  big_file:
    <<: *base_request
    name: Big File
    method: POST
    url: "{{ host }}/anything"
    body: "{{ file('Cargo.lock') }}"

  raw_json:
    <<: *base_request
    name: Raw JSON
    method: POST
    url: "{{ host }}/anything"
    headers:
      Content-Type: application/json
    body: >
      {
        "location": "boston",
        "size": "HUGE"
      }

  delay:
    <<: *base_request
    name: Delay
    method: GET
    url: "{{ host }}/delay/5"

  dynamic_response_type:
    <<: *base_request
    name: Dynamic Response Type
    method: GET
    url: "{{ host }}/{{ select(['json', 'html', 'xml']) }}"

  redirect:
    <<: *base_request
    name: Redirect
    method: GET
    url: "{{host}}/redirect-to?url={{host}}/get"

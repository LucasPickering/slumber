<!--
Copied from https://github.com/rust-lang/mdBook/blob/v0.4.43/src/theme/index.hbs
Overridden to remove prev/next page buttons because they're big and useless
-->


<!DOCTYPE HTML>
<html lang="en" class="dark sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>v3 to v4 Migration - Slumber</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Slumber is a TUI (terminal user interface) HTTP client. Define, execute, and share configurable HTTP requests.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/pagetoc.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "coal" : "dark";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Slumber</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/LucasPickering/slumber" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/LucasPickering/slumber/edit/master/docs/src/other/v4_migration.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="v3-to-v4-migration"><a class="header" href="#v3-to-v4-migration">v3 to v4 Migration</a></h1>
<p>Slumber 4.0 introduced a <a href="https://github.com/LucasPickering/slumber/releases/tag/v4.0.0">set of breaking changes</a> to the collection format, requiring migration of your collection files to the new format. You have two options to migrate automatically:</p>
<p><strong>CLI Migration Tool</strong></p>
<p>You can upgrade with the migration tool included in the v4 CLI:</p>
<pre><code class="language-sh">slumber import v3 &lt;old file&gt; &lt;new file&gt;
</code></pre>
<p>The generated collection will be <em>functionally</em> equivalent to the old collection, but due to limitations in the Rust YAML ecosystem, non-semantic content such as whitespace, comments, and anchors/aliases will be lost. Depending on the complexity of your collection, this migration may be 100% of what you need, or it may provide a good starting point for you to finish cleaning up by hand. You can also use an LLM to do the touch-ups, but in that case it may just be easier to do the entire migration via LLM (see next section).</p>
<blockquote>
<p>"Functionally equivalent" means loading the TUI on the new collection should show you the exact same set of profiles/requests that you saw in v3. If this isn't the case (e.g. if a new template doesn't function the same as it did before), please <a href="https://github.com/lucaspickering/slumber/issues/new">file a bug</a>!</p>
</blockquote>
<p><strong>LLM Migration</strong></p>
<p>If you're open to using an LLM, you can provide it this guide and it should generate a v4 collection that is functionally equivalent, retain comments and deduplicate content via <code>$ref</code>. Provide it this prompt:</p>
<pre><code>Migrate this file from Slumber v3 to Slumber v4 using this guide:
https://slumber.lucaspickering.me/book/other/v4_migration.html
</code></pre>
<blockquote>
<p>Some AI Agents won't follow URLs or only fetch snippets of the page rather than the entire content. If your new collection doesn't work, try copying the entire page content below into the prompt.</p>
</blockquote>
<h2 id="manual-migration"><a class="header" href="#manual-migration">Manual Migration</a></h2>
<p>If you prefer to do the import manually, or if the automatic importer isn't working for you, here's what needs to be changed:</p>
<h3 id="rewrite-templates"><a class="header" href="#rewrite-templates">Rewrite Templates</a></h3>
<p>Rewrite templates to use the new function-based syntax:</p>
<ul>
<li>Replace each chain type with its <a href="../api/template_functions.html">equivalent function call</a></li>
<li>For chains used multiple times, deduplicate the migrated template expression using <a href="../user_guide/templates/examples.html#deduplicating-template-expressions">common profile fields</a></li>
</ul>
<p><strong>Example</strong></p>
<pre><code class="language-yaml"># v3
chains:
  file:
    source: !file
      path: "./data.txt"
    trim: both
  response:
    source: !request
      recipe: login
      selector: $.token

requests: !request
  r1:
    query:
      file: "{{chains.file}}"
      response: "{{chains.response}}"

# v4
requests:
  r1:
    query:
      file: "{{ file('./data.txt') | trim() }}"
      response: "{{ response('login') | jsonpath('$.token') }}"
</code></pre>
<p>The v3 chain sources (and their parameters) have each been replaced by a corresponding function.</p>
<blockquote>
<p>In the new template language, required arguments are passed as positional arguments <code>file("my/path")</code> while optional arguments are passed as keywords <code>prompt(default="Default")</code>. These examples include all optional arguments for completeness, but they can be omitted if not needed.</p>
</blockquote>
<p><strong><code>!command</code> becomes <a href="../api/template_functions.html#command"><code>command</code></a></strong></p>
<pre><code class="language-yaml">source: !command
  command: ["echo", "test"]
  stdin: "{{host}}"
# becomes
"{{ command(['echo', 'test'], stdin=host) }}"
</code></pre>
<blockquote>
<p>Previously, an error was not triggered if the command failed with a non-zero status code. This will now trigger an error. If you want the template to render even if the command fails, you can use something like `['sh', '-c', ]</p>
</blockquote>
<p><strong><code>!env</code> becomes <a href="../api/template_functions.html#env"><code>env</code></a></strong></p>
<pre><code class="language-yaml">source: !env
  variable: MY_VAR
# becomes
"{{ env('MY_VAR') }}"
</code></pre>
<p><strong><code>!file</code> becomes <a href="../api/template_functions.html#file"><code>file</code></a></strong></p>
<pre><code class="language-yaml">source: !file
  path: my/file
# becomes
"{{ file('my/file') }}"
</code></pre>
<p><strong><code>!prompt</code> becomes <a href="../api/template_functions.html#prompt"><code>prompt</code></a></strong></p>
<pre><code class="language-yaml">source: !prompt
  message: "Enter data"
  default: "Default"
sensitive: true
# becomes
"{{ prompt(message='Enter data', default='Default', sensitive=true) }}"
</code></pre>
<p><strong><code>!request</code> split into <a href="../api/template_functions.html#response"><code>response</code></a> and <a href="../api/template_functions.html#response_header"><code>response_header</code></a></strong></p>
<pre><code class="language-yaml">source: !request
  recipe: "login"
  trigger: !expire 12h
  section: !body
# becomes
"{{ response('login', trigger='12h') }}"
</code></pre>
<pre><code class="language-yaml">source: !request
  recipe: "login"
  trigger: !expire 12h
  section: !header Content-Type
# becomes
"{{ response_header('login', 'Content-Type', trigger='12h') }}"
</code></pre>
<p><strong><code>!select</code> becomes <a href="../api/template_functions.html#select"><code>select</code></a></strong></p>
<pre><code class="language-yaml">source: !select
  options:
    - option1
    - option2
  message: "Message"
# becomes
"{{ select(options=['option1', 'option2'], message='Message') }}"
</code></pre>
<p>In addition, the following chain fields have been replaced by utility functions:</p>
<ul>
<li><code>selector</code> and <code>selector_mode</code> -&gt; <a href="../api/template_functions.html#jsonpath"><code>jsonpath</code></a></li>
<li><code>sensitive</code> -&gt; <a href="../api/template_functions.html#sensitive"><code>sensitive</code></a></li>
<li><code>trim</code> -&gt; <a href="../api/template_functions.html#trim"><code>trim</code></a></li>
<li><code>content_type</code> is no longer needed, as only JSON was ever supported</li>
</ul>
<p>These functions can be used via the pipe operator:</p>
<pre><code class="language-yaml">source: !file
  path: "file.json"
trim: both
selector: "$.items"
selector_mode: array
sensitive: true
# becomes
"{{ file('file.json') | trim(mode='both') | jsonpath('$.items', mode='array') | sensitive() }}"
</code></pre>
<p>Finally, there is a function <code>concat()</code> that can be used to replicate the behavior of nested templates within chain config:</p>
<pre><code class="language-yaml">chains:
  file_name:
    source: !prompt
      message: File name
  path:
    source: !file
      path: "data/{{file_name}}.json"
# becomes
"{{ file(concat(['data/', prompt(message='File name'), '.json']))"
</code></pre>
<blockquote>
<p><code>concat()</code> takes a single array argument!</p>
</blockquote>
<p>This is only necessary if you have nested templates <strong>with multiple components</strong>. In other words, if you do this conversion but the array passed to <code>concat()</code> only has one element, you can just omit the <code>concat()</code>.</p>
<h3 id="replace-anchors-with-ref"><a class="header" href="#replace-anchors-with-ref">Replace Anchors with <code>$ref</code></a></h3>
<p>The previous YAML anchor/alias and spread syntax has been replaced by a more powerful <code>$ref</code> syntax, akin to <a href="https://swagger.io/docs/specification/v3_0/using-ref/">OpenAPI</a>.</p>
<pre><code class="language-yaml"># v3
.base_request: &amp;base_request
  method: GET
  headers:
    Accept: application/json

requests:
  r1: !request
    &lt;&lt;: *base_request
    url: "https://myfishes.fish/fishes"

# v4
.base_request:
  method: GET
  headers:
    Accept: application/json

requests:
  r1:
    $ref: "#/.base_request"
    url: "https://myfishes.fish/fishes"
</code></pre>
<blockquote>
<p>Same as <code>&lt;&lt;:</code>, <code>$ref</code> does <em>not</em> do a deep merge of objects. In the above example, any recipe containing a <code>headers</code> field would entirely overwrite <code>.base_request/headers</code></p>
</blockquote>
<p>See <a href="../user_guide/composition.html">Collection Reuse &amp; Composition</a> to learn more about the power of <code>$ref</code>, including sharing collection components across files.</p>
<h3 id="remove-tag-syntax"><a class="header" href="#remove-tag-syntax">Remove <code>!tag</code> Syntax</a></h3>
<p>Slumber no longer uses YAML <code>!tag</code> syntax.</p>
<ul>
<li>Remove <code>!request</code> and <code>!folder</code> entirely (they're now detected automatically)</li>
<li>Authentication: <code>!basic</code> and <code>!bearer</code> have been replaced by <code>authentication.type</code>:</li>
</ul>
<pre><code class="language-yaml"># v3
authentication: !basic
  username: user1
  password: hunter2
authentication: !bearer token123

# v4
authentication:
  type: basic
  username: user1
  password: hunter2
authentication:
  type: bearer
  token: token123
</code></pre>
<ul>
<li>Body: <code>!json</code>, <code>!form_urlencoded</code>, and <code>!form_multipart</code> have been replaced by <code>type</code> and <code>data</code> fields:</li>
</ul>
<pre><code class="language-yaml"># v3
body: !json
  key: value
body: !form_urlencoded
  field1: value
body: !form_multipart
  field1: value

# v4
body:
  type: json
  data:
    key: value
body:
  type: form_urlencoded
  data:
    field1: value
body:
  type: form_multipart
  data:
    field1: value
</code></pre>
<h3 id="query-parameters"><a class="header" href="#query-parameters">Query Parameters</a></h3>
<p>Previously, query parameters could be expressed as either a mapping of <code>param: value</code> OR a sequence of strings <code>"param=value"</code>. This enabled the use of multiple instances of the same parameter. Query parameters must be mappings now, but support both a singular OR sequence value to enable multiple values for the same parameter.</p>
<p><strong>Any <code>query</code> blocks already in the <code>param: value</code> format do not need to be changed</strong>.</p>
<p>For any <code>query</code> blocks in the <code>"param=value"</code> format, update them like so:</p>
<pre><code class="language-yaml"># v3
query:
  - param1=value1
  - param1=value2
  - param2=value7

# v4
query:
  param1: [value1, value2]
  param2: value7
</code></pre>

                    </main>
                </div>
            </div>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/pagetoc.js"></script>


    </div>
    </body>
</html>

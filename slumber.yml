id: example

profiles:
  - id: works
    name: Works
    data:
      host: https://httpbin.org
      username: !template "xX{{chains.username}}Xx"
      user_guid: abc123
  - id: init-fails
    name: Request Init Fails
    data:
  - id: request-fails
    name: Request Fails
    data:
      host: http://localhost:5000
      user_guid: abc123

chains:
  - id: username
    source: !command ["sh", "-c", "whoami | tr -d '\n'"]
  - id: password
    source: !prompt Password
    sensitive: true
  - id: auth_token
    source: !request login
    selector: $.headers["X-Amzn-Trace-Id"]

base: &base
  headers:
    Accept: application/json
    Authorization: Bearer {{chains.auth_token}}
    Content-Type: application/json

requests:
  - id: login
    method: POST
    url: "{{host}}/anything/login"
    query:
      sudo: yes_please
    body: |
      {
        "username": "{{username}}",
        "password": "{{chains.password}}"
      }

  - <<: *base
    id: get_users
    name: Get Users
    method: GET
    url: "{{host}}/get"
    query:
      foo: bar

  - <<: *base
    id: get_user
    name: Get User
    method: GET
    url: "{{host}}/anything/{{user_guid}}"

  - <<: *base
    id: modify_user
    name: Modify User
    method: PUT
    url: "{{host}}/anything/{{user_guid}}"
    body: |
      {
        "username": "new username"
      }
